<!-- Critical CSS to prevent flash when sliding in -->
<script>
  if (sessionStorage.getItem('vetsShouldSlideIn') === 'true') {
    document.write('<style id="vets-slide-preload">#vets-page-container { transform: translateX(100%); visibility: hidden; }</style>');
  }
</script>

<% content_for :head do %>
  <meta name="turbo-cache-control" content="no-cache">
<% end %>

<div class="vets-page" data-controller="slide-transition chat-scroll" id="vets-page-container">

  <div
    data-controller="nearby-vets appointment"
    <%= "data-nearby-vets-intake-id-value=\"#{@intake.id}\" data-appointment-intake-id-value=\"#{@intake.id}\"".html_safe if @intake&.id %>
    data-nearby-vets-user-marker-icon-value="<%= asset_path('fox-avatar-min.png') %>"
    class="map-wrapper"
  >
    <!-- Filter Overlay -->
    <div class="filter-overlay">
      <% if @intake.present? %>
      <%= link_to chat_intake_path(@intake),
        class: "back-to-chat-btn",
        data: { action: "click->slide-transition#slideBackToChat" } do %>
        <span class="back-arrow">‚Üê</span>
        <span>Back</span>
      <% end %>
    <% end %>
    </div>

    <!-- Fullscreen Map -->
    <div
      data-nearby-vets-target="map"
      class="map-fullscreen"
    ></div>

    <!-- Horizontal Locations List -->
    <div class="locations-horizontal-container">
      <div data-nearby-vets-target="horizontalList" class="locations-horizontal-scroll"></div>
    </div>

  </div>

</div>

<!-- Load Google Maps JS SDK (no callback, Stimulus handles init) -->
<script async
  src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAPS_API_KEY'] %>&libraries=places,marker&loading=async">
</script>
