<% content_for :head do %>
  <meta name="turbo-cache-control" content="no-cache">
<% end %>

<div
  data-controller="nearby-vets appointment"
  <%= "data-nearby-vets-intake-id-value=\"#{@intake.id}\" data-appointment-intake-id-value=\"#{@intake.id}\"".html_safe if @intake&.id %>
  class="map-wrapper"
>
  <!-- Fullscreen Map -->
  <div
    data-nearby-vets-target="map"
    class="map-fullscreen"
  ></div>

  <!-- Title overlay (top safe zone) -->
  <div class="vets-title">
    <h1 data-action="click->nearby-vets#showAllVets" style="cursor: pointer;">Nearby Vets</h1>
    <button onclick="fetch('/appointments/reset', { method: 'POST', headers: { 'X-CSRF-Token': document.querySelector('meta[name=csrf-token]').content } }).then(r => r.json()).then(d => alert(d.message || d.error))" style="margin-top: 10px; padding: 5px 10px; background: #ff6b6b; color: white; border: none; border-radius: 4px; cursor: pointer;">Reset Last Appointment</button>
  </div>

  <!-- Vet List Modal -->
  <div
    data-nearby-vets-target="listModal"
    class="vet-modal"
    style="display: none;"
  >
    <div class="vet-modal-content vet-list-modal">
      <button
        data-action="click->nearby-vets#closeListModal"
        class="vet-modal-close"
      >Ã—</button>
      <h2 class="vet-modal-title">Nearby Vets</h2>
      <div data-nearby-vets-target="vetList" class="vet-cards-list"></div>
    </div>
  </div>

  <!-- Vet Details Modal -->
  <div
    data-nearby-vets-target="detailModal"
    class="vet-modal"
    style="display: none;"
  >
    <div class="vet-modal-content">
      <!-- Content will be dynamically populated with a vet card -->
    </div>
  </div>

</div>

<!-- Load Google Maps JS SDK (no callback, Stimulus handles init) -->
<script async
  src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAPS_API_KEY'] %>&libraries=places,marker&loading=async">
</script>
